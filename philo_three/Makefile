# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: rchallie <rchallie@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2020/04/01 21:13:09 by excalibur         #+#    #+#              #
#    Updated: 2020/10/11 23:32:19 by rchallie         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

# SIMPLE =======================================================================
NAME = philo_three
# ==============================================================================

# SRCS =========================================================================
SRCS_DIR = srcs/
SRCS = 	philo_three.c	\
		time.c			\
		utils.c			\
		philosopher.c	\
		error.c			\
		init.c			\
		init_2.c		\
		monitor.c
# ==============================================================================

# INCLUDES =====================================================================
INCS_DIR = incs/philo_three.h
# ==============================================================================

# FLAGS ========================================================================
FLAGS = -Wall -Wextra -Werror
# ==============================================================================

# OBJS =========================================================================
OBJS_DIR	=	objs/
OBJ			=	$(SRCS:.c=.o)
OBJS		=	$(addprefix $(OBJS_DIR), $(OBJ))
# ==============================================================================

# COLOR ========================================================================
GREEN=$'\x1b[32m
WHITE=$'\x1b[37m
# ==============================================================================

# FROM SUBJECT =================================================================

$(OBJS_DIR)%.o :	$(SRCS_DIR)%.c	$(INCS_DIR)
	@mkdir -p	$(OBJS_DIR)
	@echo "$(_WHITE)Compiling: $(_GREEN)$<$(_WHITE)"
	@clang $(FLAGS) -c $< -o $@

$(NAME): $(OBJS)
	@clang -lpthread $(FLAGS) -o $(NAME) $(OBJS)
	@echo "$(_GREEN)Done!$(_WHITE)"

all: $(NAME)

clean:
	@echo "$(_WHITE)Cleaning: $(_GREEN)$(OBJS_DIR)$(_WHITE)"
	@rm -rf $(OBJS_DIR)

fclean: clean
	@echo "$(_WHITE)Cleaning: $(_GREEN)$(NAME)$(_WHITE)"
	@rm -f $(NAME)

re: fclean all
# ==============================================================================

# SUP ==========================================================================
# Not a good idea, not sure about valgrind & thread compatibility
# (TAKE SO MUCH TIME HUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUH) need a big time to die.
leaks: $(NAME)
	@valgrind --leak-check=yes  ./$(NAME) 4 800 200 200 1 || echo $$?

run: $(NAME)
	@./$(NAME) 4 420 200 200 || echo $$?

runb: $(NAME)
	@./$(NAME) 4 420 200 200 2 || echo $$?
# ==============================================================================